<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Etcd | 彼岸樱速</title><meta name="description" content="欢迎来到bays的笔记文档空间">
    <link rel="stylesheet" href="/assets/css/styles.c66d6f1b.css">
    <link rel="preload" href="/assets/js/runtime~app.7f03de47.js" as="script"><link rel="preload" href="/assets/css/styles.c66d6f1b.css" as="style"><link rel="preload" href="/assets/js/80.d657ec11.js" as="script"><link rel="preload" href="/assets/js/app.96bae701.js" as="script">
    <link rel="prefetch" href="/assets/js/guide_Sort.html.cc3498ab.js" as="script"><link rel="prefetch" href="/assets/js/guide_dubbo.html.e5443b69.js" as="script"><link rel="prefetch" href="/assets/js/guide_docker.html.1be59d85.js" as="script"><link rel="prefetch" href="/assets/js/guide_activeMQ.html.70fea2e2.js" as="script"><link rel="prefetch" href="/assets/js/guide_etcd.html.99df38d7.js" as="script"><link rel="prefetch" href="/assets/js/guide_awt.html.1bfb567f.js" as="script"><link rel="prefetch" href="/assets/js/guide_elasticsearch.html.1c7fe8da.js" as="script"><link rel="prefetch" href="/assets/js/guide_Arthas.html.c153b8fb.js" as="script"><link rel="prefetch" href="/assets/js/get-started.html.b5dc71a3.js" as="script"><link rel="prefetch" href="/assets/js/index.html.7a4fbc54.js" as="script"><link rel="prefetch" href="/assets/js/posts_sticky2.html.d9cac4c3.js" as="script"><link rel="prefetch" href="/assets/js/posts_archive2.html.f68e76d4.js" as="script"><link rel="prefetch" href="/assets/js/posts_archive1.html.4f0cf356.js" as="script"><link rel="prefetch" href="/assets/js/posts_article11.html.06296013.js" as="script"><link rel="prefetch" href="/assets/js/posts_article12.html.1d8d1792.js" as="script"><link rel="prefetch" href="/assets/js/posts_article10.html.5c0b3ffa.js" as="script"><link rel="prefetch" href="/assets/js/posts_article4.html.47354b73.js" as="script"><link rel="prefetch" href="/assets/js/posts_article5.html.c37516dd.js" as="script"><link rel="prefetch" href="/assets/js/posts_article6.html.93dd44a9.js" as="script"><link rel="prefetch" href="/assets/js/posts_article7.html.dcc4666e.js" as="script"><link rel="prefetch" href="/assets/js/posts_article8.html.1eb7469d.js" as="script"><link rel="prefetch" href="/assets/js/posts_article9.html.c42c4aee.js" as="script"><link rel="prefetch" href="/assets/js/posts_article3.html.39ed2ef6.js" as="script"><link rel="prefetch" href="/assets/js/posts_article1.html.4e814018.js" as="script"><link rel="prefetch" href="/assets/js/posts_article2.html.d024ac22.js" as="script"><link rel="prefetch" href="/assets/js/posts_sticky.html.3680f02b.js" as="script"><link rel="prefetch" href="/assets/js/category_category-a_index.html.52607d9f.js" as="script"><link rel="prefetch" href="/assets/js/category_category-c_index.html.512fe185.js" as="script"><link rel="prefetch" href="/assets/js/category_category-b_index.html.082a49aa.js" as="script"><link rel="prefetch" href="/assets/js/category_history_index.html.8d52ff6c.js" as="script"><link rel="prefetch" href="/assets/js/tag_tag-a_index.html.c9fbdcde.js" as="script"><link rel="prefetch" href="/assets/js/tag_tag-b_index.html.efaa4391.js" as="script"><link rel="prefetch" href="/assets/js/tag_tag-d_index.html.94a14403.js" as="script"><link rel="prefetch" href="/assets/js/tag_tag-e_index.html.848c629f.js" as="script"><link rel="prefetch" href="/assets/js/tag_tag-c_index.html.d71f5d38.js" as="script"><link rel="prefetch" href="/assets/js/category_index.html.2476444c.js" as="script"><link rel="prefetch" href="/assets/js/tag_wwii_index.html.616f6e69.js" as="script"><link rel="prefetch" href="/assets/js/tag_wwi_index.html.a7384146.js" as="script"><link rel="prefetch" href="/assets/js/404.html.73372f67.js" as="script"><link rel="prefetch" href="/assets/js/timeline_index.html.5206e93a.js" as="script"><link rel="prefetch" href="/assets/js/article_index.html.12dee35a.js" as="script"><link rel="prefetch" href="/assets/js/tag_index.html.507c41b2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/logo.png" alt="彼岸樱速"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">彼岸樱速</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://bianyingsu.github.io" aria-label="梦起" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->梦起<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/guide/activeMQ.html" aria-label="activeMQ"><!--[--><!--[--><!--]--><!--]-->activeMQ<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/article/" aria-label="Article"><!--[--><!--[--><!--]--><!--]-->Article<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/category/" aria-label="Category"><!--[--><!--[--><!--]--><!--]-->Category<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/tag/" aria-label="Tag"><!--[--><!--[--><!--]--><!--]-->Tag<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/timeline/" aria-label="Timeline"><!--[--><!--[--><!--]--><!--]-->Timeline<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://bianyingsu.github.io" aria-label="梦起" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->梦起<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/guide/activeMQ.html" aria-label="activeMQ"><!--[--><!--[--><!--]--><!--]-->activeMQ<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/article/" aria-label="Article"><!--[--><!--[--><!--]--><!--]-->Article<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/category/" aria-label="Category"><!--[--><!--[--><!--]--><!--]-->Category<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/tag/" aria-label="Tag"><!--[--><!--[--><!--]--><!--]-->Tag<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/timeline/" aria-label="Timeline"><!--[--><!--[--><!--]--><!--]-->Timeline<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/activeMQ.html" aria-label="ActiveMQ"><!--[--><!--[--><!--]--><!--]-->ActiveMQ<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/Arthas.html" aria-label="Arthas"><!--[--><!--[--><!--]--><!--]-->Arthas<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/awt.html" aria-label="AWT &amp;&amp; Swing"><!--[--><!--[--><!--]--><!--]-->AWT &amp;&amp; Swing<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/docker.html" aria-label="Docker"><!--[--><!--[--><!--]--><!--]-->Docker<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/dubbo.html" aria-label="Dubbo"><!--[--><!--[--><!--]--><!--]-->Dubbo<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/elasticsearch.html" aria-label="ElasticSearch"><!--[--><!--[--><!--]--><!--]-->ElasticSearch<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/guide/etcd.html" aria-label="Etcd"><!--[--><!--[--><!--]--><!--]-->Etcd<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/Sort.html" aria-label="Sort"><!--[--><!--[--><!--]--><!--]-->Sort<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="etcd" tabindex="-1"><a class="header-anchor" href="#etcd"><span>Etcd</span></a></h1><hr><p>aliases:</p><ul><li>etcd 标题: etcd</li></ul><hr><p><strong>Etcd教程</strong></p><p><strong>笔记本：</strong> etcd</p><p><strong>创建时…</strong> 2024/5/20 17:45 <strong>更新时…</strong> 2024/5/20 17:55</p><h1 id="etcd教程" tabindex="-1"><a class="header-anchor" href="#etcd教程"><span><strong>Etcd教程</strong></span></a></h1><h3 id="etcd简介" tabindex="-1"><a class="header-anchor" href="#etcd简介"><span><strong>etcd简介</strong></span></a></h3><p>etcd官方的定义：分布式系统中最关键数据的分布式、</p><p>可靠的键值存储。</p><p>etcd是一个由CoreOS团队开源的，基于Go语言实现</p><p>的，用于构建高可用的分布式键值(key-value)数据库。</p><h3 id="etcd特点" tabindex="-1"><a class="header-anchor" href="#etcd特点"><span><strong>etcd特点</strong></span></a></h3><ul><li><p>简单：基于 gRPC 定义了清晰、面向用户的</p></li><li><p>API。</p></li><li><p>安全：支持可选的客户端 TLS 证书自动认证特</p></li><li><p>性。</p></li><li><p>快速：每个节点可支持上万QPS读写。</p></li><li><p>可靠：基于 Raft 算法协议保证一致性。</p></li></ul><h3 id="与zookeeper对比" tabindex="-1"><a class="header-anchor" href="#与zookeeper对比"><span><strong>与zookeeper对比</strong></span></a></h3><ul><li><p>使用简单：使用 Go 语言编写部署简单；使用gRPC 定义接口，支持跨语言、跨平台特性，而zookeeper需要安装客户端，且官方只提供了java和c两种语言接口。</p></li><li><p>发展快：相较于zookeeper的缓慢发展维护，etcd正处于高速迭代开发中。</p></li><li><p>性能优越：官方提供的基准测试数据中，etcd 集群可以支持每秒 10000+ 次的写入，性能优于Zookeeper。</p></li><li><p>安全性：etcd 支持 TLS 访问，而 ZooKeeper 在权限控制方面做得略显粗糙。</p></li><li><p>稳定可靠：etcd更加稳定可靠，它的唯一目标就是把分布式一致性KV存储做到极致，所以它更注重稳定性和扩展性。</p></li></ul><h3 id="应用场景" tabindex="-1"><a class="header-anchor" href="#应用场景"><span><strong>应用场景</strong></span></a></h3><ul><li><p>服务注册与发现：服务进程在ETCD注册自己的位置，客户端应用进程向ETCD发起查询，来获取服务的位置，ETCD提供一个可用的服务列表。</p></li><li><p>发布订阅消息：数据提供者在配置中心发布消息，消息消费者订阅他们关心的主题，一旦主题有新消息发布，就会实时通知订阅者，通过这种方式可以做到分布式系统配置的集中式管理与动态更新。</p></li><li><p>负载均衡：etcd本身分布式架构存储的信息访问支持负载均衡，etcd集群化以后，每个etcd的核心节点都可以处理用户的请求。所以把数据量小但是访问频繁的消息数据直接存储到etcd中也是个不错的选择。etcd可以监控一个集群中多个节点的状态，利用etcd维护一个负载均衡节点表，当有一个请求发过来后，可以轮询式的把请求转发给存活着的节点。</p></li><li><p>分布式锁：因为etcd使用Raft算法保持了数据的强一致性，某次操作存储到集群中的值必然是全局一致的，所以很容易实现分布式锁。当有多个竞争者node节点，etcd作为总控，在分布式集群中与一个节点成功分配lock分布式队列：分布式队列的常规用法与分布式锁的控制时序用法类似，创建一个先进先出的队列，保证顺序。另一种比较有意思的实现是在保证队列达到某个条件时再统一按顺序执行。这种方法的实现可以在/queue这个目录中另外建立一个/queue/condition节点</p></li><li><p>分布式通知和协调：分布式通知与协调，与消息发布和订阅有些相似。都用到了etcd中Watche机制，通过注册与异步通知机制，实现分布式环境下不同系统之间 的通知与协调，从而对数据变更做到实时处理。实现方式：不同系统都在etcd上对同一个目录进行注册，同时设置Watcher观测该目录的变化(如果对子目录的变化也有需要，可以设置递归模式)，当某个系统更新了etcd的目录，那么设置了Watcher的系统就会收到通知作出相应处理。</p></li><li><p>主备选举：使用分布式锁，可以完成Leader竞选。这种场景通常是一些长时间CPU计算或者使用IO操作的机器，只需要竞选出的Leader计算或处理一次，就可以把结果复制给其他的Follower，从而避免重复劳动，节省计算资源。</p></li><li><p>集群监控：使用etcd来实现集群的实时性的监控，可以第一时间检测到各节点的健康状态，以完成集群的监控要求。etcd本身就有自带检点健康监控功能，实现起来也比较简单。</p></li></ul><h2 id="工作原理" tabindex="-1"><a class="header-anchor" href="#工作原理"><span><strong>工作原理</strong></span></a></h2><h3 id="架构图" tabindex="-1"><a class="header-anchor" href="#架构图"><span><strong>架构图</strong></span></a></h3><img src="/img/etcd.pdf-3-0.png"><h3 id="架构解析" tabindex="-1"><a class="header-anchor" href="#架构解析"><span><strong>架构解析</strong></span></a></h3><p>按照分层模型，etcd可分为Client层、API网络层、Raft</p><p>算法层、逻辑层和存储层。这些层的功能如下:</p><ul><li><p>Client层: Client层包括client v2和v3两个大版本APl客户端库，提供了简洁易用的API，同时支持负载均衡、节点间故障自动转移，可极大降低业务使用etcd复杂度，提升开发效率、服务可用性。</p></li><li><p>API网络层: API网络层主要包括client访问server和server节点之间的通信协议。一方面，client访问etcd server的API分为v2和v3两个大版本。v2API使用HTTP/1.x协议，v3 API使用gRPC协议。同时v3通过etcd grpc-gateway组件也支持 HTTP/1.x协议，便于各种语言的服务调用。另一方面，server之间通信协议，是指节点间通过Raft算法实现数据复制和Leader 选举等功能时使用的HTTP协议。</p></li><li><p>Raft 算法层: Raft算法层实现了Leader 选举、日志复制、ReadIndex等核心算法特性，用于保障etcd多个节点间的数据一致性、提升服务可用性等，是etcd的基石和亮点。</p></li><li><p>功能逻辑层: etcd核心特性实现层，如典型的KVServer模块、MVCC模块、 Auth鉴权模块、Lease租约模块、Compactor压缩模块等，其中MVCC模块主要由treelndex模块和boltdb 模块组成。</p></li><li><p>Store存储层: 存储层包含预写日志(WAL)模块、快照(Snapshot)模块、boltdb模块。其中WAL可保障etcd crash后数据不丢失，boltdb则保存了集群元数据和用户写入的数据。</p></li></ul><p>一个用户的请求发送过来，会经由 HTTP Server 转发</p><p>给 Store 进行具体的事务处理，如果涉及到节点的修</p><p>改，则交给 Raft 模块进行状态的变更、日志的记录，</p><p>然后再同步给别的 etcd 节点以确认数据提交，最后进</p><p>行数据的提交，再次同步。</p><h3 id="概念术语" tabindex="-1"><a class="header-anchor" href="#概念术语"><span><strong>概念术语</strong></span></a></h3><ul><li><p>Raft：etcd所采用的保证分布式系统强一致性的算法。</p></li><li><p>Node：一个Raft状态机实例。</p></li><li><p>Member：一个etcd实例。它管理着一个Node，并</p></li><li><p>且可以为客户端请求提供服务。</p></li><li><p>Cluster：由多个Member构成可以协同工作的etcd集群。</p></li><li><p>Peer：对同一个etcd集群中另外一个Member的称呼。</p></li><li><p>Client：向etcd集群发送HTTP请求的客户端。</p></li><li><p>WAL：预写式日志，etcd用于持久化存储的日志格式。</p></li><li><p>snapshot：etcd防止WAL文件过多而设置的快照，存储etcd数据状态。</p></li><li><p>Proxy：etcd的一种模式，为etcd集群提供反向代理服务。</p></li><li><p>Leader：Raft算法中通过竞选而产生的处理所有数据提交的节点。</p></li><li><p>Follower：竞选失败的节点作为Raft中的从属节点，为算法提供强一致性保证。</p></li><li><p>Candidate：当Follower超过一定时间接收不到</p></li><li><p>Leader的心跳时转变为Candidate开始竞选。</p></li><li><p>Term：某个节点成为Leader到下一次竞选时间，称为一个Term。</p></li><li><p>Index：数据项编号。Raft中通过Term和Index来定位数据。</p></li></ul><h3 id="核心特性" tabindex="-1"><a class="header-anchor" href="#核心特性"><span><strong>核心特性</strong></span></a></h3><ul><li>数据读写</li></ul><p>为了保证数据的强一致性，etcd集群中所有的数据流</p><p>向都是一个方向，从 Leader （主节点）流向</p><p>Follower，也就是所有 Follower 的数据必须与 Leader</p><p>保持一致，如果不一致会被覆盖。</p><p>用户对于etcd集群所有节点进行读写</p><p>读取：由于集群所有节点数据是强一致性的，读取可以</p><p>从集群中随便哪个节点进行读取数据</p><p>写入：etcd集群有leader，如果写入往leader写入，可</p><p>以直接写入，然后然后Leader节点会把写入分发给所</p><p>有Follower，如果往follower写入，然后Leader节点会</p><p>把写入分发给所有Follower</p><ul><li>leader选举</li></ul><p>假设三个节点的集群，三个节点上均运行Timer（每个</p><p>Timer持续时间是随机的），Raft算法使用随机Timer来</p><p>初始化Leader选举流程，第一个节点率先完成了</p><p>Timer，随后它就会向其他两个节点发送成为Leader的</p><p>请求，其他节点接收到请求后会以投票回应然后第一个</p><p>节点被选举为Leader。</p><p>成为Leader后，该节点会以固定时间间隔向其他节点</p><p>发送通知，确保自己仍是Leader。有些情况下当</p><p>Follower们收不到Leader的通知后，比如说Leader节</p><p>点宕机或者失去了连接，其他节点会重复之前选举过程</p><p>选举出新的Leader。</p><ul><li>判断数据是否写入</li></ul><p>etcd认为写入请求被Leader节点处理并分发给了多数</p><p>节点后，就是一个成功的写入。那么多少节点如何判定</p><p>呢，假设总结点数是N，那么多数节点</p><p>Quorum=N/2+1。关于如何确定etcd集群应该有多少个</p><p>节点的问题，上图的左侧的图表给出了集群中节点总数</p><p>(Instances)对应的Quorum数量，用Instances减去</p><p>Quorom就是集群中容错节点（允许出故障的节点）的</p><p>数量。</p><p>所以在集群中推荐的最少节点数量是3个，因为1和2个</p><p>节点的容错节点数都是0，一旦有一个节点宕掉整个集</p><p>群就不能正常工作了。</p><h2 id="_1-etcd介绍" tabindex="-1"><a class="header-anchor" href="#_1-etcd介绍"><span><strong>1 Etcd介绍</strong></span></a></h2><h3 id="_1-1-介绍" tabindex="-1"><a class="header-anchor" href="#_1-1-介绍"><span><strong>1.1 介绍</strong></span></a></h3><p><code>Etcd</code> 是使用Go语言开发的一个开源的、高可用的分布式</p><p>key-value存储系统，可以用于配置共享和服务的注册</p><p>和发现。</p><h3 id="_1-2-etcd特点" tabindex="-1"><a class="header-anchor" href="#_1-2-etcd特点"><span><strong>1.2 Etcd特点</strong></span></a></h3><p><code>Etcd</code> 具有以下特点：</p><p><code>完全复制</code> ：集群中的每个节点都可以使用完整的存</p><p>档。</p><p><code>高可用性</code> ：Etcd可用于避免硬件的单点故障或网络问</p><p>题。</p><p><code>一致性</code> ：每次读取都会返回跨多主机的最新写入。</p><p><code>简单</code> ：包括一个定义良好、面向用户的API</p><p>（gRPC）。</p><p><code>安全</code> ：实现了带有可选的客户端证书身份验证的自</p><p>动化TLS。</p><p><code>快速</code> ：每秒10000次写入的基准速度。</p><p><code>可靠</code> ：使用Raft算法实现了强一致、高可用的服务</p><p>存储目录。</p><h2 id="_2-etcd单机安装" tabindex="-1"><a class="header-anchor" href="#_2-etcd单机安装"><span><strong>2 Etcd单机安装</strong></span></a></h2><h3 id="_2-1-开放端口" tabindex="-1"><a class="header-anchor" href="#_2-1-开放端口"><span><strong>2.1 开放端口</strong></span></a></h3><p>开放每台机器上的2379、2380端口的命令：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">firewall-cmd --zone=public --add-port=2379/tcp --permanent</span>
<span class="line">firewall-cmd --zone=public --add-port=2380/tcp --permanent</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>重启防火墙：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">firewall-cmd --reload</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查看开放的端口：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">firewall-cmd --list-port</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-2-安装包及安装教程" tabindex="-1"><a class="header-anchor" href="#_2-2-安装包及安装教程"><span><strong>2.2 安装包及安装教程</strong></span></a></h3><p><a href="https://github.com/etcd-io/etcd/tags" target="_blank" rel="noopener noreferrer">安装包下载地址：https://github.com/etcd-io/etcd/tags</a></p><p><strong>选择最新版本，同时里面还有Linux、macOS</strong></p><p><strong>(Darwin)、Docker这三种安装方式的步骤以及安装</strong></p><p><strong>包。</strong></p><img src="/img/etcd.pdf-8-1.png"><p><strong>注意：2.2到2.4的安装方式在github上都有写，详见</strong> ：</p><p><a href="https://github.com/etcd-io/etcd/releases/tag/v3.5.13" target="_blank" rel="noopener noreferrer">https://github.com/etcd-io/etcd/releases/tag/v3.5.13</a></p><h3 id="_2-3-linux安装etcd" tabindex="-1"><a class="header-anchor" href="#_2-3-linux安装etcd"><span><strong>2.3 Linux安装Etcd</strong></span></a></h3><p><strong>2.3.1 创建执行脚本</strong></p><p>在 linux的 <code>/opt/soft/etcd/</code> 目录下创建一个脚本文件：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">vim etcd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>2.3.2 脚本内容</strong></p><div class="language-perl line-numbers-mode" data-highlighter="prismjs" data-ext="perl"><pre><code><span class="line">ETCD_VER<span class="token operator">=</span><span class="token v-string string">v3.5.13</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># choose either URL 翻译：选择下面两个任意一个地址即可</span></span>
<span class="line">GOOGLE_URL<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">//</span>storage<span class="token operator">.</span>googleapis<span class="token operator">.</span>com<span class="token operator">/</span>etcd</span>
<span class="line">GITHUB_URL<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token operator">.</span>com<span class="token operator">/</span>etcd<span class="token operator">-</span>io<span class="token operator">/</span>etcd<span class="token operator">/</span>releases<span class="token operator">/</span>download</span>
<span class="line">DOWNLOAD_URL<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">{</span>GOOGLE_URL<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">rm <span class="token operator">-f</span> <span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token operator">.</span>tar<span class="token operator">.</span>gz</span>
<span class="line">rm <span class="token operator">-</span>rf <span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test <span class="token operator">&amp;&amp;</span> mkdir <span class="token operator">-p</span> <span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test</span>
<span class="line"></span>
<span class="line">curl <span class="token operator">-</span>L <span class="token variable">$</span><span class="token punctuation">{</span>DOWNLOAD_URL<span class="token punctuation">}</span><span class="token operator">/</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token operator">.</span>tar<span class="token operator">.</span>gz <span class="token operator">-o</span> <span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token operator">.</span>tar<span class="token operator">.</span>gz</span>
<span class="line">tar <span class="token operator">-</span>zxvf <span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token operator">.</span>tar<span class="token operator">.</span>gz <span class="token operator">-C</span> <span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test <span class="token operator">--</span>strip<span class="token operator">-</span>components<span class="token operator">=</span><span class="token number">1</span></span>
<span class="line">rm <span class="token operator">-f</span> <span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token operator">.</span>tar<span class="token operator">.</span>gz</span>
<span class="line"></span>
<span class="line"><span class="token comment">#查看安装是否成功的相关命令</span></span>
<span class="line"><span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test<span class="token operator">/</span>etcd <span class="token operator">--</span>version</span>
<span class="line"><span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test<span class="token operator">/</span>etcdctl version</span>
<span class="line"><span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test<span class="token operator">/</span>etcdutl version</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.3.3 执行脚本里的命令</strong></p><p>在 <code>/opt/soft/etcd</code> 执行：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">./etcd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果在执行时提示权限不够，则需要授权，然后再次执</p><p>行即可：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">chmod 777 etcd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>2.3.4 查看Etcd安装是否成功</strong></p><p><strong>2.3.4.1 查看Etcd服务端安装是否成功</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">/opt/soft/etcd/etcd-download-test/etcd --version</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如下显示则安装成功：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">etcd Version: 3.5.13</span>
<span class="line">Git SHA: c9063a0dc</span>
<span class="line">Go Version: go1.21.8</span>
<span class="line">Go OS/Arch: linux/amd64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意 ：需要将Etcd加入到环境变量中，否则会在 <code>3.3.3</code></p><p><code>执行</code> <code>goreman</code> <code>启动命令</code> 步骤时报 <code>/bin/sh: etcd:</code> <code>未找到命令</code> 。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">vim ~/.bashrc</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>将Etcd环境变量添加到文件末尾。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">export GOROOT=/usr/local/go #GOROOT是系统上安装Go软件包的位置。</span>
<span class="line">export GOPATH=/root/go/GOPATH #GOPATH是工作目录的位置。这个是自己创建的，想放在哪都行</span>
<span class="line">export ETCD=/opt/soft/etcd/etcd-download-test=#ETCD</span>
<span class="line"></span>
<span class="line">#export PATH=$GOPATH/bin:$GOROOT/bin:$PATH</span>
<span class="line">export PATH=$GOPATH/bin:$GOROOT/bin:$ETCD:$PATHexport GOPROXY=&quot;https://goproxy.cn&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加完后按esc键退出编辑模式，输入：wq保存退出。</p><p>更新配置文件：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">source ~/.bashrc</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>2.3.4.2 查看Etcd客户端安装是否成功</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">/opt/soft/etcd/etcd-download-test/etcdctl version</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如下显示则安装成功：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">etcdctl version: 3.5.13</span>
<span class="line">API version: 3.5</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.3.5 测试</strong></p><ol><li>启动Etcd</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">/opt/soft/etcd/etcd-download-test/etcd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li><p>添加/查看数据</p><div class="language-perl line-numbers-mode" data-highlighter="prismjs" data-ext="perl"><pre><code><span class="line"><span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test<span class="token operator">/</span>etcdctl <span class="token operator">--</span>endpoints<span class="token operator">=</span>localhost<span class="token punctuation">:</span><span class="token number">2379</span> put foo bar</span>
<span class="line"><span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test<span class="token operator">/</span>etcdctl <span class="token operator">--</span>endpoints<span class="token operator">=</span>localhost<span class="token punctuation">:</span><span class="token number">2379</span> get foo</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>root<span class="token variable">@node1192</span> <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token comment"># /opt/soft/etcd/etcd-download-test/etcdctl --endpoints=localhost:2379 put foo bar*OK</span></span>
<span class="line"><span class="token punctuation">[</span>root<span class="token variable">@node1192</span> <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token comment"># /opt/soft/etcd/etcd-download-test/etcdctl --endpoints=localhost:2379 get foo </span></span>
<span class="line">foo</span>
<span class="line">bar</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="_2-4-macos-darwin-安装etcd-未实操" tabindex="-1"><a class="header-anchor" href="#_2-4-macos-darwin-安装etcd-未实操"><span><strong>2.4 macOS (Darwin)安装Etcd（未实操）</strong></span></a></h3><div class="language-perl line-numbers-mode" data-highlighter="prismjs" data-ext="perl"><pre><code><span class="line">ETCD_VER<span class="token operator">=</span><span class="token v-string string">v3.5.13</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># choose either URL</span></span>
<span class="line">GOOGLE_URL<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">//</span>storage<span class="token operator">.</span>googleapis<span class="token operator">.</span>com<span class="token operator">/</span>etcd</span>
<span class="line">GITHUB_URL<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token operator">.</span>com<span class="token operator">/</span>etcd<span class="token operator">-</span>io<span class="token operator">/</span>etcd<span class="token operator">/</span>releases<span class="token operator">/</span>download</span>
<span class="line">DOWNLOAD_URL<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">{</span>GOOGLE_URL<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">rm <span class="token operator">-f</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>darwin<span class="token operator">-</span>amd64<span class="token operator">.</span>zip</span>
<span class="line">rm <span class="token operator">-</span>rf <span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test <span class="token operator">&amp;&amp;</span> mkdir <span class="token operator">-p</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">curl <span class="token operator">-</span>L <span class="token variable">$</span><span class="token punctuation">{</span>DOWNLOAD_URL<span class="token punctuation">}</span><span class="token operator">/</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>darwin<span class="token operator">-</span>amd64<span class="token operator">.</span>zip <span class="token operator">-o</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>darwin<span class="token operator">-</span>amd64<span class="token operator">.</span>zip</span>
<span class="line">unzip <span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>darwin<span class="token operator">-</span>amd64<span class="token operator">.</span>zip <span class="token operator">-d</span> <span class="token operator">/</span>tmp <span class="token operator">&amp;&amp;</span> rm <span class="token operator">-f</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>darwin<span class="token operator">-</span>amd64<span class="token operator">.</span>zip</span>
<span class="line">mv <span class="token operator">/</span>tmp<span class="token regex">/etcd-${ETCD_VER}-darwin-amd64/</span><span class="token operator">*</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test <span class="token operator">&amp;&amp;</span> rm <span class="token operator">-</span>rf mv <span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span><span class="token variable">$</span><span class="token punctuation">{</span>ETCD_VER<span class="token punctuation">}</span><span class="token operator">-</span>darwin<span class="token operator">-</span>amd64</span>
<span class="line"></span>
<span class="line"><span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test<span class="token operator">/</span>etcd <span class="token operator">--</span>version</span>
<span class="line"><span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test<span class="token operator">/</span>etcdctl version</span>
<span class="line"><span class="token operator">/</span>tmp<span class="token operator">/</span>etcd<span class="token operator">-</span>download<span class="token operator">-</span>test<span class="token operator">/</span>etcdutl version</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-docker安装etcd-推荐" tabindex="-1"><a class="header-anchor" href="#_2-5-docker安装etcd-推荐"><span><strong>2.5 Docker安装Etcd（推荐）</strong></span></a></h3><p>Docker安装Etcd前，需要先在Linux上安装Docker，</p><p><a href="https://blog.csdn.net/Mr_XiMu/article/details/104268176" target="_blank" rel="noopener noreferrer">Docker的安装步骤参见：centos7安装docker</a></p><p><strong>1 创建Etcd的数据目录</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">mkdir -p /opt/soft/etcd/data</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>2 Docker部署Etcd</strong></p><ol><li>拉取镜像：</li></ol><div class="language-perl line-numbers-mode" data-highlighter="prismjs" data-ext="perl"><pre><code><span class="line"><span class="token comment">#拉取etcd镜像</span></span>
<span class="line">docker pull quay<span class="token operator">.</span>io<span class="token operator">/</span>coreos<span class="token operator">/</span>etcd<span class="token punctuation">:</span><span class="token v-string string">v3.5.13</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Docker运行Etcd：</li></ol><div class="language-perl line-numbers-mode" data-highlighter="prismjs" data-ext="perl"><pre><code><span class="line">docker run <span class="token operator">-d</span> <span class="token operator">\</span></span>
<span class="line"><span class="token operator">-p</span> <span class="token number">2379</span><span class="token punctuation">:</span><span class="token number">2379</span> <span class="token operator">\</span></span>
<span class="line"><span class="token operator">-p</span> <span class="token number">2380</span><span class="token punctuation">:</span><span class="token number">2380</span> <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>restart<span class="token operator">=</span>always <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>mount type<span class="token operator">=</span>bind<span class="token punctuation">,</span>source<span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>soft<span class="token operator">/</span>etcd<span class="token operator">/</span>data<span class="token punctuation">,</span>destination<span class="token operator">=</span><span class="token operator">/</span>etcd<span class="token operator">-</span>data <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>name etcd <span class="token operator">\</span></span>
<span class="line">quay<span class="token operator">.</span>io<span class="token operator">/</span>coreos<span class="token operator">/</span>etcd<span class="token punctuation">:</span><span class="token v-string string">v3.5.13</span> <span class="token operator">\</span></span>
<span class="line"><span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>bin<span class="token operator">/</span>etcd <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>name s1 <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>data<span class="token operator">-</span>dir <span class="token operator">/</span>etcd<span class="token operator">-</span>data <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>listen<span class="token operator">-</span>client<span class="token operator">-</span>urls http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token v-string string">0.0.0.0</span><span class="token punctuation">:</span><span class="token number">2379</span> <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>advertise<span class="token operator">-</span>client<span class="token operator">-</span>urls http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token v-string string">0.0.0.0</span><span class="token punctuation">:</span><span class="token number">2379</span> <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>listen<span class="token operator">-</span>peer<span class="token operator">-</span>urls http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token v-string string">0.0.0.0</span><span class="token punctuation">:</span><span class="token number">2380</span> <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>initial<span class="token operator">-</span>advertise<span class="token operator">-</span>peer<span class="token operator">-</span>urls http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token v-string string">0.0.0.0</span><span class="token punctuation">:</span><span class="token number">2380</span> <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>initial<span class="token operator">-</span>cluster s1<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token v-string string">0.0.0.0</span><span class="token punctuation">:</span><span class="token number">2380</span> <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>initial<span class="token operator">-</span>cluster<span class="token operator">-</span>token tkn <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>initial<span class="token operator">-</span>cluster<span class="token operator">-</span><span class="token keyword">state</span> new <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>log<span class="token operator">-</span>level info <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>logger zap <span class="token operator">\</span></span>
<span class="line"><span class="token operator">--</span>log<span class="token operator">-</span>outputs stderr</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3 Docker查看Etcd版本及使用</strong></p><p>相关命令：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line"># 查看Etcd服务器版本</span>
<span class="line">docker exec etcd /usr/local/bin/etcd --version</span>
<span class="line"></span>
<span class="line"># 查看Etcd客户端版本</span>
<span class="line">docker exec etcd /usr/local/bin/etcdctl version</span>
<span class="line">docker exec etcd /usr/local/bin/etcdutl version</span>
<span class="line"></span>
<span class="line"># 查看Etcd健康状况</span>
<span class="line">docker exec etcd /usr/local/bin/etcdctl endpoint health</span>
<span class="line"></span>
<span class="line"># Etcd添加数据</span>
<span class="line">docker exec etcd /usr/local/bin/etcdctl put foo bar</span>
<span class="line"></span>
<span class="line"># Etcd查看数据</span>
<span class="line">docker exec etcd /usr/local/bin/etcdctl get foo</span>
<span class="line"></span>
<span class="line"># Etcd查看所有数据</span>
<span class="line">docker exec etcd /usr/local/bin/etcdctl get --prefix &quot;&quot;</span>
<span class="line"></span>
<span class="line"># Etcd删除数据 </span>
<span class="line">docker exec etcd /usr/local/bin/etcdctl del foo</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行结果：</p><div class="language-perl line-numbers-mode" data-highlighter="prismjs" data-ext="perl"><pre><code><span class="line"><span class="token punctuation">[</span>root<span class="token variable">@node1192</span> soft<span class="token punctuation">]</span><span class="token comment"># docker exec etcd /usr/local/bin/etcd --version</span></span>
<span class="line">etcd Version<span class="token punctuation">:</span> <span class="token v-string string">3.5.13</span></span>
<span class="line">Git SHA<span class="token punctuation">:</span> c9063a0dc</span>
<span class="line">Go Version<span class="token punctuation">:</span> go<span class="token v-string string">1.21.8</span></span>
<span class="line">Go OS<span class="token operator">/</span>Arch<span class="token punctuation">:</span> linux<span class="token operator">/</span>amd64</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>root<span class="token variable">@node1192</span> soft<span class="token punctuation">]</span><span class="token comment"># docker exec etcd /usr/local/bin/etcdctl version</span></span>
<span class="line">etcdctl version<span class="token punctuation">:</span> <span class="token v-string string">3.5.13</span></span>
<span class="line">API version<span class="token punctuation">:</span> <span class="token number">3.5</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>root<span class="token variable">@node1192</span> soft<span class="token punctuation">]</span><span class="token comment"># docker exec etcd /usr/local/bin/etcdutl version</span></span>
<span class="line">etcdutl version<span class="token punctuation">:</span> <span class="token v-string string">3.5.13</span></span>
<span class="line">API version<span class="token punctuation">:</span> <span class="token number">3.5</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>root<span class="token variable">@node1192</span> soft<span class="token punctuation">]</span><span class="token comment"># docker exec etcd /usr/local/bin/etcdctl endpoint health</span></span>
<span class="line"><span class="token v-string string">127.0.0.1</span><span class="token punctuation">:</span><span class="token number">2379</span> is healthy<span class="token punctuation">:</span> successfully committed proposal<span class="token punctuation">:</span> took <span class="token operator">=</span> <span class="token number">5</span><span class="token operator">.</span>561765ms</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>root<span class="token variable">@node1192</span> soft<span class="token punctuation">]</span><span class="token comment"># docker exec etcd /usr/local/bin/etcdctl put foo bar</span></span>
<span class="line">OK</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>root<span class="token variable">@node1192</span> soft<span class="token punctuation">]</span><span class="token comment"># docker exec etcd /usr/local/bin/etcdctl get foo</span></span>
<span class="line">foo</span>
<span class="line">bar</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>root<span class="token variable">@node1192</span> soft<span class="token punctuation">]</span><span class="token comment"># docker exec etcd /usr/local/bin/etcdctl get --prefix &quot;&quot;</span></span>
<span class="line">foo</span>
<span class="line">bar</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>root<span class="token variable">@node1192</span> soft<span class="token punctuation">]</span><span class="token comment"># docker exec etcd /usr/local/bin/etcdctl del foo</span></span>
<span class="line"><span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新：: </span><time class="meta-item-info" datetime="2026-01-08T10:05:18.000Z" data-allow-mismatch>2026/1/8 10:05</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: wuyuying@foresee.com.cn">wuyuying</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/guide/elasticsearch.html" aria-label="ElasticSearch"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">ElasticSearch</span></div><!--]--></a><a class="route-link auto-link next" href="/guide/Sort.html" aria-label="Sort"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">Sort</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.7f03de47.js" defer></script><script src="/assets/js/80.d657ec11.js" defer></script><script src="/assets/js/app.96bae701.js" defer></script>
  </body>
</html>
